{"version":3,"sources":["../../../lib/db.js","../../../models/User.js"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n    cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n    if (!MONGODB_URI) {\r\n        throw new Error('Please define the MONGODB_URI environment variable inside .env');\r\n    }\r\n\r\n    if (cached.conn) {\r\n        return cached.conn;\r\n    }\r\n\r\n    if (!cached.promise) {\r\n        const opts = {\r\n            bufferCommands: false,\r\n        };\r\n\r\n        cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n            return mongoose;\r\n        });\r\n    }\r\n\r\n    try {\r\n        cached.conn = await cached.promise;\r\n    } catch (e) {\r\n        cached.promise = null;\r\n        throw e;\r\n    }\r\n\r\n    return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n","import mongoose from 'mongoose';\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n    username: { type: String, required: true, unique: true },\r\n    email: { type: String, required: true, unique: true },\r\n    password: { type: String, required: true },\r\n    role: { type: String, enum: ['admin', 'staff'], default: 'admin' }\r\n}, { timestamps: true });\r\n\r\nUserSchema.pre('save', async function (next) {\r\n    if (!this.isModified('password')) return next();\r\n    const bcrypt = await import('bcryptjs');\r\n    this.password = await bcrypt.default.hash(this.password, 10);\r\n    next();\r\n});\r\n\r\nUserSchema.methods.comparePassword = async function (candidatePassword) {\r\n    const bcrypt = await import('bcryptjs');\r\n    return bcrypt.default.compare(candidatePassword, this.password);\r\n};\r\n\r\nexport default mongoose.models.User || mongoose.model('User', UserSchema);\r\n"],"names":[],"mappings":"q6BAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAc,QAAQ,GAAG,CAAC,WAAW,CAOvC,EAAS,EAAA,CAAA,CAAO,GAAP,KAAe,CAM5B,eAAe,IACX,GAAI,CAAC,EACD,MAAM,AAAI,KADI,CACE,kEAGpB,GAAI,EAAO,IAAI,CACX,CADa,MACN,EAAO,IAAI,CAGjB,EAAO,OAAO,EAAE,CAKjB,EAAO,OAAO,CAAG,EAAA,OAAQ,CAAC,OAAO,CAAC,EAJrB,CACT,UAG2C,MAH3B,CACpB,GAEqD,IAAI,CAAC,AAAC,GAChD,EACX,EAGJ,GAAI,CACA,EAAO,IAAI,CAAG,MAAM,EAAO,OAAO,AACtC,CAAE,MAAO,EAAG,CAER,MADA,EAAO,OAAO,CAAG,KACX,CACV,CAEA,OAAO,EAAO,IAAI,AACtB,CA/BI,AAAC,IACD,EAAS,EADA,AACA,CAAA,CAAO,GAAP,KAAe,CAAG,CAAE,KAAM,KAAM,QAAS,KAAK,mBAgC5C,uFC5Cf,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAa,IAAI,EAAA,OAAQ,CAAC,MAAM,CAAC,CACnC,SAAU,CAAE,KAAM,OAAQ,UAAU,EAAM,QAAQ,CAAK,EACvD,MAAO,CAAE,KAAM,OAAQ,UAAU,EAAM,QAAQ,CAAK,EACpD,SAAU,CAAE,KAAM,OAAQ,SAAU,EAAK,EACzC,KAAM,CAAE,KAAM,OAAQ,KAAM,CAAC,QAAS,QAAQ,CAAE,QAAS,OAAQ,CACrE,EAAG,CAAE,YAAY,CAAK,GAEtB,EAAW,GAAG,CAAC,OAAQ,eAAgB,CAAI,EACvC,GAAI,CAAC,IAAI,CAAC,UAAU,CAAC,YAAa,OAAO,IACzC,IAAM,EAAS,MAAA,EAAA,CAAA,CAAA,MACf,KAAI,CAAC,QAAQ,CAAG,MAAM,EAAO,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAE,IACzD,GACJ,GAEA,EAAW,OAAO,CAAC,eAAe,CAAG,eAAgB,CAAiB,EAElE,MAAO,CADQ,MAAA,EAAA,CAAA,CAAA,MAAA,EACD,OAAO,CAAC,OAAO,CAAC,EAAmB,IAAI,CAAC,QAAQ,CAClE,QAEe,EAAA,OAAQ,CAAC,MAAM,CAAC,IAAI,EAAI,EAAA,OAAQ,CAAC,KAAK,CAAC,OAAQ"}